import { SheetsClient } from '@/core/client.js';
{{#if hasSchema}}
  {{#if rangeName}}
import {
  {{rangeName}}
} from '../../core/constants.js';
  {{/if}}
{{/if}}
import {
  {{featureName}}
} from '../../core/types.js';

// Cache crypto availability check
let hasCrypto: boolean | null = null;

// Utility for UUID
function generateUuid(): string {
  if (typeof Utilities !== 'undefined') {
    return Utilities.getUuid();
  }

  // Cache crypto check to avoid repeated typeof checks
  if (hasCrypto === null) {
    hasCrypto = typeof crypto !== 'undefined' && typeof crypto.randomUUID === 'function';
  }

  if (hasCrypto) {
    return crypto.randomUUID();
  }

  // Fallback for environments without crypto
  throw new Error('UUID generation not available in this environment');
}

/**
 * Universal {{featureName}} repository factory for GAS/Node.js environments
 *
 * ðŸš¨ é‡è¦: client.tsã®SheetsClientã‚’ç›´æŽ¥ä½¿ç”¨
 * SheetsClientã¯IIFEãƒ‘ã‚¿ãƒ¼ãƒ³ã§æ—¢ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ç›´æŽ¥ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™
 *
 * @example
 * ```typescript
 * import { Universal{{featureName}}Repo } from './features/{{featureNameCamel}}/Universal{{featureName}}Repo.js';
 *
 * const repo = Universal{{featureName}}Repo.create(spreadsheetId);
{{#if hasSchema}}
 * const items = await repo.getAll();
 * await repo.create({ title: 'Example' });
{{else}}
 * // TODO: Add example usage
{{/if}}
 * ```
 */
export const Universal{{featureName}}Repo = (() => {
  /**
   * âœ… GASã¨Node.jsã§å®Œå…¨ã«åŒä¸€ã®å®Ÿè£…
   */
  const create = (spreadsheetId: string) => {
{{#if hasSchema}}
    // Conversion helpers
    {{{rowToObject}}}

    {{{objectToRow}}}

    // Repository operations
    {{{operationCodes}}}

    return {
      {{{exportsList}}}
    } as const;
{{else}}
    // TODO: Implement operations using SheetsClient
    // Available operations:
    {{#each operations}}
    // - {{{this}}}
    {{/each}}

    return {
      // TODO: Return methods here
    } as const;
{{/if}}
  };

  return { create } as const;
})();
